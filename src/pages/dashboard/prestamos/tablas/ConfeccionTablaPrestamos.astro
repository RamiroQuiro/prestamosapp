---
import {users as User, prestamos as Prestamo , clientes as Cliente} from "@/db/schema";
import TablaPrestamos from "./TablaPrestamos";
import db from "@/db";
import { desc, eq } from "drizzle-orm";
let prestamos = [];
let arrayBody = [];
let usuario=[]
const {id}=Astro.locals.user

try {
usuario=await db.select().from(User).where(eq(User.id,id))
  prestamos = await db
    .select()
    .from(Prestamo)
    .where(eq(Prestamo.usuarioId, id))
    .innerJoin(Cliente, eq(Prestamo.clienteId, Cliente.id))
// console.log(prestamos)
  arrayBody = prestamos.map((element) => {
    return {
      href:`/dashboard/prestamos/${element.prestamos.id}`,
      id:element?.prestamos.id,
      cliente: element?.clientes.nombre + ' '+ element?.clientes.apellido,
      montoCuota: `$ ${element?.prestamos?.montoCuota.toLocaleString()}`,
      nCuotas: element?.prestamos.nCuotas,
      montoTotal:`$ ${ element?.prestamos.montoTotal.toLocaleString()}`,
      fechaVencimiento: element?.prestamos.fechaFin,
      tasaInteres: `${element?.prestamos.tasaInteres}%`,
      estado:element?.prestamos.estado
    };
  });
} catch (error) {
  console.log(error);
}

---

<TablaPrestamos arrayBody={arrayBody} usuario={usuario[0]} client:load/>
 
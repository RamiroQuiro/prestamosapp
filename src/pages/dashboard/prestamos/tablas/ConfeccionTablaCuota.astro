---
import { db } from "astro:db";
import { Prestamo } from "astro:db";
import { eq } from "astro:db";
import { Cliente } from "astro:db";
import { Cuota } from "astro:db";
import TablaPrestamo from "./TablaCuota"
import { formatHora } from "../[idPrestamo]/index.astro";
let cuotas = [];
let arrayBody = [];

const { idPrestamo } = Astro.params;
const userId = "123456";


try {
  cuotas = await db
    .select()
    .from(Cuota)
    .where(eq(Cuota.prestamoId, idPrestamo));

  arrayBody = cuotas.map((element) => {
    const horaFormateada = formatHora(element.fechaVencimiento);
    return {
      id:element.id,
      cuota: element.numeroCuota,
      fechaVencimiento: horaFormateada,
      importeCuota: `$ ${element.monto.toLocaleString()}`,
      estado: element.pagada ,
    };
  });
} catch (error) {
  console.log(error);
}

// enlace de la tabla al que me redirige con el id
const enlaceFila=`/dashboard/prestamos/${idPrestamo}/cuota/`
---

<TablaPrestamo enlaceFila={enlaceFila} arrayBody={arrayBody} client:load/ >

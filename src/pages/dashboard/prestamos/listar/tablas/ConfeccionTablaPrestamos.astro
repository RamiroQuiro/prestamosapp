---
import { db } from "astro:db";
import { Prestamo } from "astro:db";
import { eq } from "astro:db";
import { Cliente } from "astro:db";
import TablaPrestamos from "./TablaPrestamos";
import { asc } from "astro:db";
import { desc } from "astro:db";
let prestamos = [];
let arrayBody = [];
const user=Astro.locals.user

try {
  prestamos = await db
    .select()
    .from(Prestamo)
    .where(eq(Prestamo.usuarioId, user.id))
    .innerJoin(Cliente, eq(Prestamo.clienteId, Cliente.id)).orderBy(desc(Prestamo.fechaCreacion));

  arrayBody = prestamos.map((element) => {
    return {
      id:element?.Prestamo.id,
      cliente: element?.Cliente.nombre + ' '+ element?.Cliente.apellido,
      montoCuota: `$ ${element?.Prestamo?.montoCuota.toLocaleString()}`,
      nCuotas: element?.Prestamo.nCuotas,
      montoTotal:`$ ${ element?.Prestamo.montoTotal.toLocaleString()}`,
      fechaVencimiento: element?.Prestamo.fechaFin,
      tasaInteres: `${element?.Prestamo.tasaInteres}%`,
      estado:element?.Prestamo.estado
    };
  });
} catch (error) {
  console.log(error);
}

// enlace de la tabla al que me redirige con el id
const enlaceFila=`/dashboard/prestamos/listar/`
---

<TablaPrestamos arrayBody={arrayBody} enlaceFila={enlaceFila} client:load/>
 